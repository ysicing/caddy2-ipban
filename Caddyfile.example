# ipban Caddyfile 配置示例
#
# 全局声明处理顺序（必须放在全局选项块中）
{
	order ipban first
}

# ============================================================
# 用法一：零配置（推荐）
# 使用内置默认规则，所有参数取默认值
# ============================================================
example.com {
	ipban
}

# ============================================================
# 用法二：自定义配置
# ============================================================
example2.com {
	ipban {
		# 规则来源（不配置则使用内置默认规则）
		# 本地文件（fsnotify 热重载）：
		rule_source /etc/caddy/rules.json
		# 或远程 URL（ETag + 定时刷新）：
		# rule_source https://example.com/rules.json
		refresh_interval 1h

		# 白名单（私有/回环 IP 自动跳过）
		allow 198.51.100.0/24 203.0.113.50

		# 封禁时长（默认 7 天）
		ban_duration 24h

		# 返回给被封禁请求的状态码（默认: 451，可自定义多个随机返回）
		# status_codes 400 403 404 429
	}
}

# ============================================================
# 管理 API（Caddy Admin 默认监听 localhost:2019）
#
# 查看封禁列表：
#   curl http://localhost:2019/ipban/banned
#
# 解封 IP：
#   curl -X POST http://localhost:2019/ipban/unban -d '{"ip":"1.2.3.4"}'
# ============================================================
